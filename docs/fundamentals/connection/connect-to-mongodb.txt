.. _laravel-connect-to-mongodb:

================
Connection Guide
================

.. facet::
   :name: genre
   :values: reference

.. meta::
   :keywords: code example, seedlist, dsn, data source name

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

Overview
--------

In this guide, you can learn how to connect your Laravel application to a
MongoDB instance or replica set deployment by using {+odm-short+}.

This guide includes the following sections:

- :ref:`Connection URI <laravel-connection-uri>` describes connection URIs
  and their constituent parts
- :ref:`Database Configuration File <laravel-database-config-file>`
- :ref:`Connection Example <laravel-atlas-connection-example>` provides
  examples that show how to connect to MongoDB by using an Atlas
  connection string
- :ref:`Other Ways to Connect to MongoDB <laravel-other-ways-to-connect>`
  describes ways to connect to MongoDB deployments that are not hosted
  on Atlas

.. _laravel-connection-uri:

Connection URI
--------------

A **connection URI**, also known as a connection string, tells the
driver how to connect to MongoDB and how to behave while connected.

Parts of a Connection URI
~~~~~~~~~~~~~~~~~~~~~~~~~

The following example explains each part of a sample connection URI:

.. figure:: /includes/figures/connection_uri_parts.png
   :alt: Parts of a connection URI

In this example, we use ``mongodb`` for the protocol, which specifies the
:manual:`Standard Connection String Format
</reference/connection-string/#std-label-connections-standard-connection-string-format>`.
You can also use the :manual:`DNS Seed List Connection Format
</reference/connection-string/#dns-seed-list-connection-format>` if you
want more flexibility in your deployment and the ability to change the
servers in rotation without reconfiguring clients.

If you are using password-based authentication, the part of the
connection string after the protocol contains your username and
password. Replace the placeholder for ``user`` with your username and
``pass`` with your password. If you are using an authentication
mechanism that does not require a username and password, omit
this part of the connection URI.

The part of the connection string after the credentials specifies the
hostname or IP address and port of your MongoDB instance. In the
preceding example, we use ``sample.host`` as the hostname and ``27017``
as the port. Replace these values to point to your MongoDB instance.

The last part of the connection string specifies connection and authentication
options. In the example, we set two connection options:
``maxPoolSize=20`` and ``w=majority``.

.. _laravel-database-config-file:

Database Configuration File
---------------------------

TODO:
This section will show how to add the connection URI to your DSN setting in
the config/database.php file.


.. _laravel-atlas-connection-example:


Connection Example
------------------

The following code shows how you can create a client that uses an Atlas
connection string and the {+stable-api+} version, connect to MongoDB, and
verify that the connection is successful.


TODO:


.. tip::

   Follow the :ref:`Create a Connection String <laravel-quick-start-connection-string>`
   tutorial in the Quick Start to retrieve your Atlas connection string.

.. _laravel-other-ways-to-connect:

Other Ways to Connect to MongoDB
--------------------------------

If you must connect to a single MongoDB server instance or replica set
that is not hosted on Atlas, see the following sections to find out how to
connect.


.. _laravel-connect-localhost:

Connect to a MongoDB Server on Your Local Machine
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

TODO

.. _laravel-connect-replica-set:

Connect to a Replica Set
~~~~~~~~~~~~~~~~~~~~~~~~

A MongoDB replica set deployment is a group of connected instances, or nodes,
where the nodes store the same set of data. This configuration of instances
provides data redundancy and high data availability.

To connect to a replica set deployment, specify the hostname and port numbers
of each instance, separated by commas, and the replica set name as the value
of the ``replicaSet`` parameter in the connection string.

In the following example, the hostnames are ``host1``, ``host2``, and
``host3``, and the port numbers are all ``27017``. The replica set name
is ``myRS``. The following code shows the connection URI for the replica
set with these specifications:

.. code-block:: none

   mongodb://host1:27017,host2:27017,host3:27017/?replicaSet=myRS

When connecting to a replica set, the driver takes the following actions by default:

- Discovers all replica set members when given the address of any one member.
- Sends operations to the appropriate member, such as instructions
  to write against the **primary** node. To learn more about the replica
  set primary, see :manual:`Replica Set Primary </core/replica-set-primary/>` in the {+server-docs-name+}.

.. tip::

   You are only required to specify one host to connect to a replica set.
   However, to ensure connectivity when the specified host
   is unavailable, provide the full list of hosts.

Direct Connection
`````````````````

To force operations on the host designated in the connection URI,
specify the ``directConnection`` option. Direct connections display the
following behavior:

- They don't support SRV strings.
- They fail on writes when the specified host is not the primary.
- They require you to :manual:`specify a secondary read preference
  </core/read-preference/#mongodb-readmode-secondary>` when the
  specified host isn't the primary member. To learn more about these
  replica set members, see :manual:`Replica Set Secondary Members
  </core/replica-set-secondary/>` in the Server manual.
